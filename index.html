<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Бизнес Предсказание 2026</title>
    
    <!-- Telegram Web App Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Manrope:wght@400;600&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

    <style>
        /* --- SETTINGS --- */
        :root {
            --color-bg: #001a16;
            --primary: #00B399;
            --secondary: #008E7A;
            --accent: #04C9B0;
            
            /* Fluid Aurora Palette (RGB values) */
            --color1: 0, 26, 22;      /* Darkest Base */
            --color2: 0, 179, 153;    /* Primary */
            --color3: 4, 201, 176;    /* Accent */
            --color4: 0, 142, 122;    /* Secondary */
            --color5: 0, 60, 50;      /* Deep Emerald */
            --color-interactive: 100, 255, 218;
            
            /* Card Dimensions */
            --card-ratio: 1.6;
            --card-height: 55vh; /* Desktop height */
            --card-width: calc(var(--card-height) / var(--card-ratio));
            
            --btn-radius: 96px;
            
            /* Safe Area for Telegram Mini Apps on iPhone */
            --safe-area-top: env(safe-area-inset-top, 20px);
            --safe-area-bottom: env(safe-area-inset-bottom, 20px);
        }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden;
            background-color: var(--color-bg);
            font-family: 'SB Sans Display', 'SB Sans Regular', 'Manrope', 'Montserrat', sans-serif;
            color: white;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: none;
        }

        /* --- OPTIMIZED BACKGROUND (Fluid Gradient Aurora) --- */
        .ambient-bg {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; z-index: 0;
            background: var(--color-bg);
            overflow: hidden;
        }

        .gradients-container {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0; left: 0;
            filter: blur(80px); 
            transform: translate3d(0, 0, 0);
        }

        .g-blob {
            position: absolute;
            background: radial-gradient(circle at center, rgba(var(--color-rgb), 0.8) 0, rgba(var(--color-rgb), 0) 50%) no-repeat;
            mix-blend-mode: hard-light;
            width: var(--size);
            height: var(--size);
            top: calc(50% - var(--size) / 2);
            left: calc(50% - var(--size) / 2);
            transform-origin: center center;
            opacity: 1;
            will-change: transform, opacity;
        }

        .g1 {
            --color-rgb: var(--color1);
            --size: 80vw;
            animation: moveVertical 30s ease infinite;
        }

        .g2 {
            --color-rgb: var(--color2);
            --size: 60vw;
            animation: moveInCircle 20s reverse infinite;
            transform-origin: calc(50% - 400px);
        }

        .g3 {
            --color-rgb: var(--color3);
            --size: 50vw;
            animation: moveInCircle 40s linear infinite;
            transform-origin: calc(50% + 400px);
            top: calc(50% - var(--size) / 2 + 200px);
            left: calc(50% - var(--size) / 2 - 500px);
        }

        .g4 {
            --color-rgb: var(--color4);
            --size: 40vw;
            animation: moveHorizontal 40s ease infinite;
            transform-origin: calc(50% - 200px);
            opacity: 0.7;
        }

        .g5 {
            --color-rgb: var(--color5);
            --size: 80vw;
            animation: moveInCircle 20s ease infinite;
            transform-origin: calc(50% - 800px) calc(50% + 200px);
        }
        
        .interactive {
            --color-rgb: var(--color-interactive);
            --size: 40vw;
            background: radial-gradient(circle at center, rgba(var(--color-rgb), 0.8) 0, rgba(var(--color-rgb), 0) 50%) no-repeat;
            mix-blend-mode: hard-light;
            width: 100%; height: 100%;
            top: -50%; left: -50%;
            opacity: 0.4;
            animation: moveInCircle 60s ease infinite;
        }

        @keyframes moveInCircle {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes moveVertical {
            0% { transform: translateY(-50%); }
            50% { transform: translateY(50%); }
            100% { transform: translateY(-50%); }
        }

        @keyframes moveHorizontal {
            0% { transform: translateX(-50%) translateY(-10%); }
            50% { transform: translateX(50%) translateY(10%); }
            100% { transform: translateX(-50%) translateY(-10%); }
        }

        /* Cursor Trail Canvas */
        #trail-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 9999;
        }

        /* --- APP CONTAINER --- */
        #app-container {
            position: relative;
            width: 100%; height: 100%;
            z-index: 10;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            perspective: 1000px; 
            overflow: hidden;
            /* Padding for safe areas */
            padding-top: var(--safe-area-top);
            padding-bottom: var(--safe-area-bottom);
            box-sizing: border-box;
        }

        /* --- BUTTONS --- */
        .common-btn {
            position: relative;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(4, 201, 176, 0.6);
            color: white;
            border-radius: var(--btn-radius);
            font-family: 'SB Sans Regular', 'Manrope', sans-serif;
            font-weight: 400; 
            text-transform: none; 
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 50;
            font-size: 14px; 
            padding: 12px 24px;
        }

        .btn-intro {
            font-family: 'SB Sans Display', 'Manrope', sans-serif;
            font-size: 16px; 
            font-weight: 600;
            padding: 18px 48px;
            background: linear-gradient(65deg, rgba(0, 102, 89, 0.5) 0%, rgba(0, 166, 145, 0.5) 100%);
            border: 1px solid #04C9B0;
            box-shadow: 0 0 25px rgba(4, 201, 176, 0.3);
        }

        .btn-icon-only {
            width: 58px;
            height: 58px;
            padding: 0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .btn-icon-only svg {
            width: 28px;
            height: 28px;
            fill: none;
            stroke: currentColor;
            stroke-width: 0;
        }

        .common-btn:hover {
            background: rgba(4, 201, 176, 0.25);
            border-color: #04C9B0;
            box-shadow: 0 0 30px rgba(4, 201, 176, 0.5);
            transform: scale(1.03);
        }

        /* --- SCENES --- */
        .scene {
            position: absolute; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.8s ease, transform 0.8s ease;
        }
        #scene-intro { z-index: 20; width: 100%; }
        .hidden { opacity: 0; pointer-events: none; transform: scale(1.1); }

        /* --- INTRO DESIGN --- */
        .intro-design-wrapper {
            position: relative;
            width: 100%; height: 100%;
            max-width: 1920px;
            display: flex; align-items: center; justify-content: center;
        }

        .design-elements {
            position: absolute; inset: 0;
            pointer-events: none;
            overflow: hidden;
            display: flex; align-items: center; justify-content: center;
        }

        .svg-blob-bg {
            position: absolute; 
            width: 120%; min-width: 1200px;
            opacity: 0.6;
            z-index: 1;
            mix-blend-mode: screen;
        }

        /* --- 2026 STATIC DARK WATERMARK --- */
        .svg-2026-container {
            position: absolute;
            width: 85%; max-width: 1100px;
            z-index: 2;
            top: 48%; left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none; 
            opacity: 0.6; 
        }
        
        .svg-2026-path {
            fill: #000a08; 
            stroke: rgba(255, 255, 255, 0.03); 
            stroke-width: 1px;
        }

        .ring-shape {
            position: absolute;
            border-radius: 50%;
            border: 2px rgba(4, 201, 176, 0.4) solid;
            pointer-events: none;
            z-index: 1;
            box-shadow: 0 0 20px rgba(4, 201, 176, 0.1);
        }
        .ring-1 {
            width: 70vw; height: 70vw;
            max-width: 1200px; max-height: 1200px;
            left: -15%; top: 40%;
            transform: rotate(-22deg);
        }
        .ring-2 {
            width: 70vw; height: 70vw;
            max-width: 1200px; max-height: 1200px;
            right: -15%; top: 50%;
            transform: rotate(21deg);
        }
        
        /* REMOVED STAR DECOR CSS */

        .intro-content-layer {
            position: relative; z-index: 10;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            width: 100%; height: 100%;
            text-align: center;
            pointer-events: none;
        }
        
        .intro-content-layer > * {
            pointer-events: auto;
        }

        /* --- UPDATED TITLES ALIGNMENT --- */
        .main-title-group {
            position: relative;
            margin-bottom: 50px;
            display: flex; flex-direction: column; 
            width: 100%;
            /* Changed for 12-column layout width */
            max-width: 1200px; 
            padding: 0 30px; /* Padding for mobile edges */
            box-sizing: border-box;
            text-shadow: 0 10px 30px rgba(0,0,0,0.8);
            pointer-events: none;
        }

        .h1-business {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
            /* Equalized font size: clamp(40px, 10vw, 130px) */
            font-size: clamp(40px, 10vw, 130px);
            color: white;
            line-height: 1.0;
            margin: 0;
            
            /* Align LEFT */
            align-self: flex-start;
            text-align: left;
        }
        
        .h1-prediction {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
            /* Equalized font size: clamp(40px, 10vw, 130px) */
            font-size: clamp(40px, 10vw, 130px);
            color: white;
            line-height: 1.0;
            margin: 0;
            margin-top: 10px;
            
            /* Align RIGHT */
            align-self: flex-end;
            text-align: right;
            text-transform: lowercase; 
        }

        .intro-btn-group { 
            margin-top: 4vh;
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 16px; 
        }
        
        .intro-disclaimer {
            position: absolute; bottom: calc(30px + var(--safe-area-bottom));
            font-family: 'SB Sans Display', 'Manrope', sans-serif;
            font-size: 11px;
            color: rgba(255,255,255,0.5);
            text-align: center;
            width: 90%;
        }

        /* --- GALLERY SCENE --- */
        #scene-vortex {
            z-index: 15; opacity: 0; pointer-events: none;
            transform-style: preserve-3d;
            transition: opacity 1s, transform 1s;
        }
        #scene-vortex.active { opacity: 1; pointer-events: auto; }
        
        .carousel-pivot {
            position: absolute; top: 45%; left: 50%;
            width: 0; height: 0;
            transform-style: preserve-3d;
            transform: translate(-50%, -50%) rotateX(0deg) !important; 
        }

        .card-wrapper {
            position: absolute; top: 50%; left: 50%;
            width: var(--card-width); height: var(--card-height);
            margin-left: calc(var(--card-width) * -0.5);
            margin-top: calc(var(--card-height) * -0.5);
            transform-style: preserve-3d;
            will-change: transform;
            pointer-events: auto; 
        }

        .card-wrapper::before {
            content: ''; position: absolute;
            top: -50px; left: -50px; right: -50px; bottom: -50px;
            z-index: -1;
        }

        .card {
            width: 100%; height: 100%; position: relative;
            transform-style: preserve-3d;
            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), box-shadow 0.3s ease, filter 0.3s ease;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.8);
            background: #000;
        }

        .card.hovered {
            box-shadow: 0 0 30px rgba(4, 201, 176, 0.7), 0 0 10px rgba(255, 255, 255, 0.4);
            border: 1px solid rgba(4, 201, 176, 0.8);
            transform: scale(1.05);
        }

        .card-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden;
            border-radius: 20px; overflow: hidden;
            background: #021813;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .card-face.face-back::after {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(to bottom, transparent 30%, rgba(1, 17, 14, 0.9) 65%, rgba(1, 17, 14, 1) 100%);
            pointer-events: none;
            z-index: 1;
        }
        
        .card-face img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .face-front { transform: rotateY(0deg); }
        .face-back { transform: rotateY(180deg); }

        .pred-content {
            position: absolute; bottom: 0; left: 0; width: 100%;
            padding: 20px 16px; 
            box-sizing: border-box;
            color: white; text-align: left; z-index: 2;
            transform: translateY(20px); opacity: 0;
            transition: opacity 1.5s ease-out, transform 1.5s ease-out;
            display: flex; flex-direction: column; justify-content: flex-end;
            max-height: 60%;
        }
        
        .face-back.visible .pred-content { transform: translateY(0); opacity: 1; }

        .pred-title {
            font-family: 'SB Sans Display', 'Manrope', sans-serif;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #fff;
            line-height: 1.2;
            text-transform: uppercase;
        }

        .pred-text { 
            font-family: 'SB Sans Regular', 'Manrope', sans-serif;
            font-size: 11px;
            line-height: 1.4; 
            font-weight: 400; 
            color: #ccfbf5; 
            opacity: 0.9;
        }

        /* --- POPUP (CENTERED FIX) --- */
        #popup-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(1, 20, 17, 0.85);
            backdrop-filter: blur(15px);
            z-index: 1000;
            display: none;
            align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.5s;
        }
        #popup-overlay.open { opacity: 1; }
        
        .popup-content {
            background: rgba(0, 50, 40, 0.8);
            border: 1px solid rgba(4, 201, 176, 0.5);
            border-radius: 24px;
            padding: 40px;
            max-width: 90%; width: 400px;
            
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            transform: scale(0.9); transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            
            /* ADDED: Flex centering ensures text and button are perfectly centered */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        #popup-overlay.open .popup-content { transform: scale(1); }

        .popup-text {
            font-family: 'Manrope', sans-serif;
            font-size: 15px; line-height: 1.6; color: #fff;
            margin-bottom: 25px;
            text-align: center; /* Ensures text lines are centered */
        }
        .popup-close {
            position: absolute; top: 15px; right: 15px;
            background: transparent; border: none; color: rgba(255,255,255,0.4);
            font-size: 24px; cursor: pointer;
        }

        /* --- UI CONTROLS --- */
        .controls-container {
            position: absolute; 
            bottom: calc(8% + var(--safe-area-bottom));
            display: flex; flex-direction: column; align-items: center; gap: 10px;
            opacity: 0.9; transition: opacity 0.3s; z-index: 30;
            width: 100%;
        }

        #final-ui {
            position: absolute; 
            bottom: calc(8% + var(--safe-area-bottom));
            z-index: 100;
            display: none; flex-direction: row; gap: 15px;
            justify-content: center; width: 100%;
            opacity: 0; animation: fadeInUI 1.5s forwards 0.5s; 
        }
        @keyframes fadeInUI { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        @keyframes floatResult {
            0%, 100% { transform: translate3d(0, 0, 100px) translateY(0); }
            50% { transform: translate3d(0, 0, 100px) translateY(-15px); }
        }

        .final-glow {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 120vw; height: 120vh;
            background: radial-gradient(circle, rgba(4, 201, 176, 0.2) 0%, transparent 60%);
            z-index: 4; opacity: 0; transition: opacity 1.5s; pointer-events: none;
        }
        
        #particles-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 5; pointer-events: none; overflow: hidden;
        }
        .particle { position: absolute; background: white; border-radius: 50%; opacity: 0; }
        @keyframes emanate {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.2); }
            20% { opacity: 0.8; }
            100% { opacity: 0; transform: translate(var(--tx), var(--ty)) scale(1.5); }
        }

        /* --- RESPONSIVE --- */
        @media (max-width: 1440px) {
            :root { --card-height: 50vh; }
        }

        @media (max-width: 768px) {
            :root { 
                --card-height: 48vh; 
                --card-ratio: 1.45;  
            }
            .intro-design-wrapper { flex-direction: column; }
            
            /* Responsive adjustments for titles */
            .h1-business { 
                align-self: flex-start; /* Keep left on mobile */
                margin-left: 0; 
                text-align: left;
            }
            .h1-prediction { 
                align-self: flex-end; /* Keep right on mobile */
                text-align: right;
            }
            
            .svg-2026-container { width: 100%; top: 40%; }
            .intro-btn-group { margin-top: 10px; }
            .ring-1, .ring-2 { opacity: 0.3; } 
            .btn-intro { padding: 15px 35px; font-size: 15px; }
        }
    </style>
</head>
<body>

    <!-- Ambient Aurora Background (Optimized CSS Version) -->
    <div class="ambient-bg">
        <div class="gradients-container">
            <div class="g-blob g1"></div>
            <div class="g-blob g2"></div>
            <div class="g-blob g3"></div>
            <div class="g-blob g4"></div>
            <div class="g-blob g5"></div>
            <div class="g-blob interactive"></div>
        </div>
    </div>

    <!-- Cursor Trail Canvas -->
    <canvas id="trail-canvas"></canvas>

    <div id="app-container">
        <div class="final-glow" id="final-glow"></div>
        <div id="particles-container"></div>

        <!-- POPUP -->
        <div id="popup-overlay">
            <div class="popup-content">
                <button class="popup-close" onclick="togglePopup(false)">×</button>
                <div class="popup-text">
                    Перед тем, как тянуть карту…<br><br>
                    Сделайте глубокий вдох. Представьте, как ваш бизнес цветёт в следующем году.<br><br>
                    Тяните карту. Подсознание уже всё знает.
                </div>
                <!-- Centered button by flex container -->
                <button class="common-btn" onclick="togglePopup(false)">Понятно</button>
            </div>
        </div>

        <!-- SCENE 1: INTRO -->
        <div id="scene-intro" class="scene">
            <div class="intro-design-wrapper">
                
                <!-- Background Design Layer -->
                <div class="design-elements">
                    
                    <!-- Blob Shape -->
                    <div class="svg-blob-bg">
                         <svg viewBox="0 0 1299 1020" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g filter="url(#filter0_f)">
                                <path d="M512 0C631 -60 902 45 633 390C363 728 180 640 133 565C36 412 242 144 512 0Z" fill="#00B399"/>
                            </g>
                            <defs>
                                <filter id="filter0_f" x="-200" y="-200" width="1600" height="1600" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                                    <feGaussianBlur stdDeviation="150" result="effect1_foregroundBlur"/>
                                </filter>
                            </defs>
                        </svg>
                    </div>

                    <!-- 2026 STATIC & DARK -->
                    <div class="svg-2026-container">
                        <svg viewBox="0 0 1264 525" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path class="svg-2026-path" d="M809.035 60.0586C834.708 60.0586 856.377 69.0082 874.041 86.9082C891.941 104.808 900.891 126.948 900.891 153.327C900.891 194.309 862.383 253.662 785.365 331.386C758.751 358.236 738.142 379.434 723.539 394.979C738.613 395.921 753.098 396.745 766.994 397.451C780.89 397.922 794.198 398.157 806.916 398.157C842.009 398.157 867.446 396.98 883.227 394.625C899.242 392.034 910.194 387.912 916.082 382.26C923.619 374.723 931.392 364.477 939.399 351.523C947.407 338.569 952.236 332.093 953.885 332.093C955.298 332.093 956.947 332.681 958.831 333.858C960.715 335.036 961.657 335.979 961.657 336.686C961.656 337.079 959.529 340.993 955.285 348.433L957.419 346.578L878.282 524.637C879.869 516.699 892.859 453.979 874.937 434.376C870.168 433.313 863.864 432.78 856.023 432.78H847.19C789.722 432.78 734.373 434.075 681.145 436.666C673.372 436.902 668.662 437.02 667.013 437.02H662.066C659.711 437.02 658.298 436.666 657.827 435.96C657.356 435.489 657.12 434.193 657.12 432.073C657.121 429.718 663.951 423.83 677.611 414.409C691.272 404.753 705.168 392.976 719.3 379.08C764.285 335.508 798.201 295.468 821.047 258.961C843.893 222.219 855.316 189.48 855.316 160.746C855.316 136.958 848.839 117.881 835.886 103.514C823.167 89.1465 806.209 81.9629 785.012 81.9629C759.339 81.9629 732.018 96.3301 703.048 125.064C697.16 130.952 693.627 133.896 692.449 133.896C691.272 133.896 689.388 132.718 686.797 130.363C684.442 128.008 683.264 126.359 683.264 125.417C683.264 117.88 696.807 105.162 723.893 87.2617C751.214 69.1263 779.594 60.0586 809.035 60.0586ZM151.915 60.0586C177.587 60.0586 199.256 69.0082 216.921 86.9082C234.821 104.808 243.77 126.948 243.771 153.327C243.771 194.309 205.262 253.662 128.244 331.386C101.63 358.236 81.0216 379.434 66.4189 394.979C81.4924 395.921 95.9771 396.745 109.873 397.451C123.769 397.922 137.077 398.157 149.795 398.157C184.888 398.157 210.326 396.98 226.106 394.625C242.122 392.034 253.074 387.912 258.962 382.26C266.499 374.723 274.271 364.477 282.279 351.523C290.287 338.569 295.116 332.093 296.765 332.093C298.178 332.093 299.826 332.681 301.71 333.858C303.594 335.036 304.536 335.979 304.536 336.686C304.534 337.108 302.084 341.59 297.191 350.137L304.536 343.751L225.399 521.81C226.845 514.577 237.758 461.864 226.129 437.726C225.067 437.059 224 436.471 222.927 435.96C217.981 433.84 209.972 432.78 198.902 432.78H190.07C132.602 432.78 77.2525 434.075 24.0234 436.666C16.2519 436.902 11.5416 437.02 9.89258 437.02H4.94629C2.59138 437.02 1.1783 436.666 0.707031 435.96C0.235977 435.489 0 434.193 0 432.073C0.000669264 429.718 6.83131 423.83 20.4912 414.409C34.1516 404.753 48.0472 392.976 62.1787 379.08C107.164 335.508 141.081 295.468 163.927 258.961C186.773 222.219 198.196 189.48 198.196 160.746C198.196 136.958 191.719 117.881 178.765 103.514C166.046 89.1466 149.089 81.963 127.892 81.9629C102.219 81.9629 74.8976 96.3301 45.9277 125.064C40.0398 130.952 36.5068 133.896 35.3291 133.896C34.1515 133.896 32.2675 132.718 29.6768 130.363C27.3215 128.008 26.1436 126.359 26.1436 125.417C26.1439 117.88 39.6864 105.161 66.7715 87.2617C94.0926 69.1261 122.474 60.0586 151.915 60.0586ZM1211.08 0C1212.73 2.72746e-05 1214.02 0.588275 1214.97 1.76562C1216.14 2.70773 1216.73 4.12164 1216.73 6.00586C1216.73 7.89042 1209.31 13.3075 1194.48 22.2568C1179.87 31.2068 1166.09 40.7455 1153.14 50.873C1116.87 78.4297 1089.67 109.52 1071.53 144.143C1053.39 178.529 1044.33 216.567 1044.33 258.255C1044.33 304.889 1055.75 343.987 1078.6 375.548C1101.44 406.873 1128.65 422.535 1160.21 422.535C1181.64 422.535 1198.95 415.116 1212.14 400.278C1225.33 385.205 1231.92 365.184 1231.92 340.219C1231.92 307.176 1222.9 277.94 1204.85 252.509C1196.21 266.473 1180.79 269.937 1180.7 269.957C1180.75 269.781 1194.11 222.683 1141.49 210.278C1138.82 209.997 1136.1 209.855 1133.36 209.854C1118.05 209.854 1101.44 215.507 1083.54 226.812C1080.72 228.461 1079.07 229.285 1078.6 229.285C1078.12 229.285 1077.18 228.461 1075.77 226.812C1074.59 225.164 1074 224.104 1074 223.633C1074 220.335 1084.37 212.916 1105.09 201.375C1125.82 189.599 1144.66 183.711 1161.62 183.711C1190.12 183.711 1214.26 195.604 1234.04 219.393C1253.83 242.945 1263.72 272.151 1263.72 307.009C1263.72 345.4 1251.94 377.314 1228.39 402.751C1204.84 427.952 1175.16 440.553 1139.36 440.553C1099.79 440.553 1066.7 424.773 1040.09 393.212C1017.66 366.18 1004.77 332.765 1001.41 292.966C982.988 223.427 998.667 143.72 1027.39 114.596C1027.34 114.712 1004.42 158.173 1016.62 184.661C1021.3 172.331 1027 160.12 1033.73 148.028C1055.87 107.989 1086.49 73.8374 1125.58 45.5742C1141.6 34.0334 1159.03 23.5519 1177.87 14.1309C1196.71 4.70994 1207.78 0 1211.08 0ZM488.247 68.8906C532.997 68.8907 569.503 85.7318 597.767 119.412C601.084 123.366 604.205 127.456 607.134 131.679C662.378 195.511 673.243 301.832 648.761 343.72C648.79 343.533 661.253 291.612 639.362 270.387C635.846 314.931 620.687 353.164 593.881 385.086C563.262 421.593 526.638 439.847 484.008 439.847C441.849 439.847 406.519 422.77 378.021 388.619C367.281 375.552 358.584 361.176 351.925 345.49C309.113 277.737 307.815 180.199 333.801 142.405C333.772 142.545 316.934 195.253 338.902 217.406C344.865 181.857 358.964 150.723 381.2 124.005C411.819 87.2626 447.501 68.8906 488.247 68.8906ZM479.768 81.9629C450.327 81.963 426.421 96.3302 408.05 125.064C389.679 153.799 380.493 191.954 380.493 239.53C380.493 293.937 391.21 338.805 412.643 374.134C434.076 409.463 460.808 427.128 492.84 427.128C524.165 427.128 549.013 412.761 567.384 384.026C585.99 355.292 595.294 316.077 595.294 266.381C595.294 212.21 584.46 167.93 562.791 133.543C541.123 99.1562 513.448 81.9629 479.768 81.9629ZM486.258 148.606C486.501 146.209 489.995 146.208 490.237 148.606L497.706 222.389C498.854 233.732 507.824 242.701 519.167 243.85L592.949 251.318C595.347 251.561 595.347 255.055 592.949 255.298L519.167 262.767C507.824 263.915 498.854 272.885 497.706 284.228L490.237 358.01C489.995 360.408 486.501 360.408 486.258 358.01L478.788 284.228C477.64 272.885 468.671 263.915 457.328 262.767L383.546 255.298C381.148 255.055 381.148 251.561 383.546 251.318L457.328 243.85C468.671 242.701 477.64 233.731 478.788 222.389L486.258 148.606Z" />
                        </svg>
                    </div>

                    <div class="ring-shape ring-1"></div>
                    <div class="ring-shape ring-2"></div>
                </div>

                <!-- Intro Content -->
                <div class="intro-content-layer">
                    <div class="main-title-group">
                        <h1 class="h1-business">Бизнес</h1>
                        <h1 class="h1-prediction"><span>предсказание!</span></h1>
                    </div>
                    
                    <div class="intro-btn-group">
                         <button class="common-btn btn-intro" onclick="startGame()">
                            Получить предсказание
                        </button>
                        <button class="common-btn btn-icon-only" onclick="togglePopup(true)" title="Инструкция">
                            <svg viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M40 0C42.2963 21.0671 58.9329 37.7037 80 40C58.9329 42.2963 42.2963 58.9329 40 80C37.7037 58.9329 21.0671 42.2963 0 40C21.0671 37.7037 37.7037 21.0671 40 0Z" fill="#04C9B0"/>
                            </svg>
                        </button>
                    </div>

                    <div class="intro-disclaimer">
                        *Предсказание носит развлекательный характер, и не претендует на реальное предвидение событий. Все зависит только от вас!
                    </div>
                </div>
            </div>
        </div>

        <!-- SCENE 2: GALLERY -->
        <div id="scene-vortex" class="scene">
            <div class="carousel-pivot" id="carousel-root"></div>
            
            <div class="controls-container">
                <button class="common-btn" onclick="spinCards()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/></svg>
                    Вращать
                </button>
            </div>
        </div>

        <!-- UI FINALS -->
        <div id="final-ui">
            <button class="common-btn" onclick="resetGame()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>
                Повторить
            </button>
            <button class="common-btn" onclick="shareResult()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></svg>
                Поделиться
            </button>
        </div>
        
    </div>

    <script>
        // --- DATA ---
        const predictions = [
            { 
                title: "Новые инструменты в симфонии продаж",
                text: "Найти новый канал продаж. Ваш бизнес играет мелодию, но пока только на одном инструменте! Пора подключать новые и открывать ещё один канал продаж: пусть звон монет звучит в стерео.",
                img: "images/1.webp" 
            },
            { 
                title: "Дайте им ноты!",
                text: "Повысить экспертизу сотрудников. Сейчас ваша команда — как джазовый оркестр, где каждый играет душевно, но не всегда в унисон. Предоставьте им обучение, и у вас появится ансамбль, который виртуозно импровизирует.",
                img: "images/2.webp" 
            },
            { 
                title: "Выйдите на новую сцену",
                text: "Выйти на новую нишу. Где-то есть клуб, в котором публика ждёт именно ваш жанр музыки. Найдите эту сцену и станьте её хедлайнером.",
                img: "images/3.webp" 
            },
            { 
                title: "Новые тексты и новые хиты",
                text: "Переосмыслить рекламные сообщения. Ваши рекламные тексты звучат, как демоверсия: идея есть, но сердечко не цепляет. Освежите лирику, и клиенты будут напевать ваш оффер весь день.",
                img: "images/4.webp" 
            },
            { 
                title: "Запишите ремейк!",
                text: "Переосмыслить программу лояльности. Сейчас программа лояльности напоминает оперу на языке, которого никто не знает. Упростите, сделайте ритмичнее, и клиенты будут возвращаться туда, как на любимый концерт.",
                img: "images/5.webp" 
            },
            { 
                title: "Заземлитесь и послушайте шум дождя",
                text: "Расслабиться. Всё под контролем, ничего менять не надо. Оркестр играет, дирижёр уверенно машет, а вы ищете, где звук пропал. Успокойтесь, у вас всё работает, как надо.",
                img: "images/6.webp" 
            },
            { 
                title: "Когда бэк-вокал превращается в солистов",
                text: "Мотивировать сотрудников. Команда чувствует себя, как бэк-вокал, которому забыли включить микрофоны. Добавьте им признания и энергии, и они запоют так, что продажи взлетят.",
                img: "images/7.webp" 
            },
            { 
                title: "Персональный плейлист для каждого клиента",
                text: "Продумать персонализированные предложения. Создайте предложения, которые звучат, как персональный трек: будто вы DJ и знаете вкус каждого слушателя.",
                img: "images/8.webp" 
            }
        ];
        
        const backImage = "images/back.webp";

        // --- ELEMENTS ---
        const introScene = document.getElementById('scene-intro');
        const vortexScene = document.getElementById('scene-vortex');
        const carouselRoot = document.getElementById('carousel-root');
        const finalUi = document.getElementById('final-ui');
        const particlesContainer = document.getElementById('particles-container');
        const finalGlow = document.getElementById('final-glow');
        const controlsContainer = document.querySelector('.controls-container');
        const popupOverlay = document.getElementById('popup-overlay');

        let cards = [];
        let angle = 0; 
        let isDragging = false;
        let startX = 0;
        let currentVelocity = 0;
        let animationFrame;
        let particleInterval;
        let state = 'intro';

        function init() {
            // Telegram Mini App Initialization
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();
                // Ensure colors match if needed, but we use a custom aurora theme
                window.Telegram.WebApp.setHeaderColor('#001a16'); 
                window.Telegram.WebApp.setBackgroundColor('#001a16');
            }

            createCards();
            initTrail(); // Cursor trail
        }

        // --- POPUP ---
        function togglePopup(show) {
            popupOverlay.style.display = show ? 'flex' : 'none';
            setTimeout(() => {
                if(show) popupOverlay.classList.add('open');
                else popupOverlay.classList.remove('open');
            }, 10);
        }

        function createCards() {
            carouselRoot.innerHTML = '';
            cards = [];
            const step = 360 / predictions.length;
            
            predictions.forEach((item, index) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'card-wrapper';
                // Note: Added robust error handling for images to support preview without local files
                wrapper.innerHTML = `
                    <div class="card">
                        <div class="card-face face-front">
                            <img src="${backImage}" onerror="this.src='https://placehold.co/300x480/004d40/80cbc4?text=◆'" alt="Cover">
                        </div>
                        <div class="card-face face-back">
                            <img src="${item.img}" onerror="this.src='https://placehold.co/300x480/002b24/42E3B4?text=${index+1}'" alt="Pred">
                            <div class="pred-content">
                                <div class="pred-title">${item.title}</div>
                                <div class="pred-text">${item.text}</div>
                            </div>
                        </div>
                    </div>
                `;
                
                wrapper.isHovered = false;
                wrapper.onmouseenter = () => { wrapper.isHovered = true; };
                wrapper.onmouseleave = () => { wrapper.isHovered = false; };
                wrapper.dataset.baseAngle = index * step;
                wrapper.addEventListener('click', () => {
                    if (state === 'spinning' && Math.abs(currentVelocity) < 1.5) {
                        if (wrapper.dataset.interactive === 'true') selectCard(wrapper);
                    }
                });
                carouselRoot.appendChild(wrapper);
                cards.push(wrapper);
            });
        }

        // --- CURSOR TRAIL ---
        function initTrail() {
            const canvas = document.getElementById('trail-canvas');
            const ctx = canvas.getContext('2d');
            let width = canvas.width = window.innerWidth;
            let height = canvas.height = window.innerHeight;
            
            const trailParticles = [];
            
            window.addEventListener('resize', () => {
                width = canvas.width = window.innerWidth;
                height = canvas.height = window.innerHeight;
            });

            const addParticle = (x, y) => {
                trailParticles.push({
                    x: x, y: y,
                    vx: (Math.random() - 0.5) * 1.5,
                    vy: (Math.random() - 0.5) * 1.5,
                    life: 1.0,
                    size: Math.random() * 2 + 0.5,
                    color: `hsla(${165 + Math.random() * 20}, 100%, 75%, 1)`
                });
            };

            document.addEventListener('mousemove', e => addParticle(e.clientX, e.clientY));
            document.addEventListener('touchmove', e => addParticle(e.touches[0].clientX, e.touches[0].clientY));

            function animateTrail() {
                ctx.clearRect(0, 0, width, height);
                
                for (let i = trailParticles.length - 1; i >= 0; i--) {
                    const p = trailParticles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.life -= 0.025; // Fade speed
                    
                    if (p.life <= 0) {
                        trailParticles.splice(i, 1);
                        continue;
                    }
                    
                    ctx.globalAlpha = p.life;
                    ctx.fillStyle = p.color;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fill();
                }
                ctx.globalAlpha = 1;
                requestAnimationFrame(animateTrail);
            }
            animateTrail();
        }

        // --- CAROUSEL LOGIC ---
        function renderCarousel() {
            if (state === 'result') return;

            if (!isDragging && state === 'spinning') {
                const isAnyHovered = cards.some(c => c.isHovered);
                currentVelocity *= isAnyHovered ? 0.85 : 0.96;
                angle += currentVelocity;
                if (Math.abs(currentVelocity) < 0.1 && !isAnyHovered) angle += 0.05; 
            }

            const count = predictions.length;
            const spacingMultiplier = 1.05; 
            
            const cardElem = document.querySelector('.card-wrapper');
            let cardWidth = 300; 
            if(cardElem) {
                cardWidth = cardElem.offsetWidth;
            } else {
                 const compStyles = getComputedStyle(document.documentElement);
                 const h = window.innerHeight * parseFloat(compStyles.getPropertyValue('--card-height')) / 100;
                 const r = parseFloat(compStyles.getPropertyValue('--card-ratio'));
                 cardWidth = h / r;
            }

            const radius = (count * cardWidth * spacingMultiplier) / (2 * Math.PI);
            
            carouselRoot.style.transform = `translate(-50%, -50%) rotateX(0deg)`;

            cards.forEach(card => {
                const base = parseFloat(card.dataset.baseAngle);
                const theta = (base + angle) * Math.PI / 180;
                
                const x = Math.sin(theta) * radius;
                const z = (Math.cos(theta) * radius) - radius;
                const rotY = (base + angle);
                
                const isInteractive = z > (-0.8 * radius); 
                card.dataset.interactive = isInteractive;

                let distFactor = (z + 2 * radius) / (2 * radius);
                let blur = z < -100 ? Math.abs(z) / 40 : 0;
                let opacity = 0.4 + (distFactor * 0.6);
                let scale = 1;
                let brightness = 0.5 + (distFactor * 0.5);

                const inner = card.querySelector('.card');

                if (isInteractive && card.isHovered) {
                    scale = 1.05; brightness = 1.3; blur = 0; opacity = 1;
                    inner.classList.add('hovered');
                } else {
                    inner.classList.remove('hovered');
                }

                card.style.transform = `translate3d(${x}px, 0, ${z}px) rotateY(${rotY}deg) scale(${scale})`;
                card.style.opacity = opacity;
                
                inner.style.filter = blur > 0.5 ? `blur(${blur}px)` : 'none';
                inner.style.brightness = brightness;
            });

            animationFrame = requestAnimationFrame(renderCarousel);
        }

        function spinCards() {
            if(state !== 'spinning') return;
            currentVelocity += (Math.random() > 0.5 ? 1 : -1) * (15 + Math.random() * 10);
        }

        // --- CONTROLS ---
        document.addEventListener('mousedown', e => { if(state==='spinning'){ isDragging=true; startX=e.clientX; } });
        document.addEventListener('touchstart', e => { if(state==='spinning'){ isDragging=true; startX=e.touches[0].clientX; } }, {passive:false});
        document.addEventListener('mousemove', e => {
            if (!isDragging) return;
            const dx = e.clientX - startX; startX = e.clientX;
            currentVelocity = dx * 0.3; angle += currentVelocity;
        });
        document.addEventListener('touchmove', e => {
            if (!isDragging) return;
            const dx = e.touches[0].clientX - startX; startX = e.touches[0].clientX;
            currentVelocity = dx * 0.3; angle += currentVelocity;
        }, {passive:false});
        document.addEventListener('mouseup', () => isDragging = false);
        document.addEventListener('touchend', () => isDragging = false);

        // --- GAMEFLOW ---
        function startGame() {
            introScene.classList.add('hidden');
            setTimeout(() => {
                introScene.style.display = 'none';
                vortexScene.classList.add('active');
                state = 'spinning';
                currentVelocity = 20; 
                renderCarousel();
            }, 600);
        }

        function selectCard(cardWrapper) {
            state = 'selecting';
            cancelAnimationFrame(animationFrame);
            controlsContainer.style.display = 'none'; 
            
            cards.forEach(c => {
                if (c !== cardWrapper) {
                    c.style.transition = 'all 0.8s ease';
                    c.style.transform = c.style.transform + ' scale(0.1)';
                    c.style.opacity = 0;
                }
            });

            cardWrapper.style.transition = 'all 1.0s cubic-bezier(0.19, 1, 0.22, 1)';
            carouselRoot.style.transform = `translate(-50%, -50%) rotateX(0deg)`;
            
            cardWrapper.style.transform = `translate3d(0, 0, 100px) rotateY(0deg)`; 
            cardWrapper.style.zIndex = 100;
            
            const inner = cardWrapper.querySelector('.card');
            inner.classList.remove('hovered'); 
            inner.style.filter = 'none';
            inner.style.brightness = '1';
            inner.style.boxShadow = '0 0 50px rgba(4, 201, 176, 0.5)';
            inner.style.transition = 'transform 0.8s ease';

            setTimeout(() => {
                inner.style.transform = 'rotateY(180deg)';
                setTimeout(() => {
                    cardWrapper.querySelector('.face-back').classList.add('visible');
                    cardWrapper.style.animation = 'floatResult 4s ease-in-out infinite';
                    startEmanatingParticles(); 
                    finalGlow.style.opacity = '1';
                    finalUi.style.display = 'flex';
                    state = 'result';
                }, 800); 
            }, 100);
        }

        function startEmanatingParticles() {
            if(particleInterval) clearInterval(particleInterval);
            const spawn = () => {
                if(state !== 'result') return;
                const p = document.createElement('div');
                p.className = 'particle';
                const size = Math.random() * 6 + 2;
                p.style.width = size + 'px'; p.style.height = size + 'px';
                const hue = Math.random() > 0.5 ? 160 : 180;
                p.style.background = `hsl(${hue}, 100%, 70%)`;
                p.style.boxShadow = `0 0 10px hsl(${hue}, 100%, 60%)`;
                p.style.left = '50%'; p.style.top = '50%';
                
                const angle = Math.random() * Math.PI * 2;
                const dist = 300 + Math.random() * 200;
                const tx = Math.cos(angle) * dist + 'px';
                const ty = Math.sin(angle) * dist + 'px';
                p.style.setProperty('--tx', tx); p.style.setProperty('--ty', ty);
                
                p.style.animation = `emanate ${2 + Math.random()}s ease-out forwards`;
                particlesContainer.appendChild(p);
                setTimeout(() => { if(p.parentNode) p.parentNode.removeChild(p); }, 3000);
            };
            particleInterval = setInterval(spawn, 50);
        }

        function resetGame() {
            finalUi.style.display = 'none'; finalUi.style.opacity = '0';
            particlesContainer.innerHTML = ''; finalGlow.style.opacity = '0';
            controlsContainer.style.display = 'flex';
            if(particleInterval) clearInterval(particleInterval);
            state = 'spinning';

            const activeCard = cards.find(c => c.style.zIndex == '100');
            if(activeCard) {
                activeCard.style.zIndex = ''; 
                activeCard.style.animation = ''; 
                const inner = activeCard.querySelector('.card');
                
                inner.style.transition = 'transform 1s ease';
                inner.style.transform = 'rotateY(0deg)'; 
                inner.style.boxShadow = '0 10px 40px rgba(0,0,0,0.8)';
                activeCard.querySelector('.face-back').classList.remove('visible');
            }

            cards.forEach(c => {
                c.style.transition = 'transform 1s ease, opacity 1s ease';
                c.style.opacity = 1;
            });
            currentVelocity = 10;
            renderCarousel();
        }

        function shareResult() {
            // Find the visible result text
            const title = document.querySelector('.card-wrapper[style*="z-index: 100"] .pred-title')?.innerText || 'Мое предсказание';
            const shareText = `🔮 Мое бизнес-предсказание на 2026 год: ${title}. Узнай своё будущее!`;
            const shareUrl = window.location.href;

            if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initData.length > 0) {
                // We are inside Telegram!
                // Best way: Open the share dialog
                const tgShareUrl = `https://t.me/share/url?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(shareText)}`;
                window.Telegram.WebApp.openTelegramLink(tgShareUrl);
            } else if (navigator.share) {
                // Mobile browser fallback
                navigator.share({
                    title: 'Бизнес Предсказание 2026',
                    text: shareText,
                    url: shareUrl
                }).catch(console.error);
            } else {
                // Desktop browser fallback
                navigator.clipboard.writeText(shareText + " " + shareUrl).then(() => { 
                    alert('Текст предсказания скопирован! Вы можете отправить его в чат.'); 
                });
            }
        }

        init();
    </script>
</body>
</html>
